# Deploy file for cxx :: app-pubseq_gateway
# Contact: nobody@ncbi
# Generated by export_projet at 2019-01-04 15:56:31.423430

--- !profile://development/permanent
region: bethesda-dev
execute: deployment://app-pubseq_gateway
aliases:
  - alias://app-pubseq_gateway
activated-test: echo Ok
test-env:
  - environment://app-pubseq_gateway
termination-delay: 1440 # 1 day

--- !environment://backend/port
name: BACKEND_PORT
points-to: port://backend

--- !environment://psg/port
name: NCBI_CONFIG__SERVER__port
points-to: port://backend

--- !profile://staging/temporary
region: bethesda-extprod
execute: deployment://app-pubseq_gateway
aliases:
  - alias://app-pubseq_gateway
termination-delay: 1440 # 1 day

--- !port://backend/private
attached-to: scaling-group://web

--- !environment://linkerd/http-proxy
name: http_proxy
template: "{host}:{port}"

--- !environment://app-pubseq_gateway/alias
name: SERVICE_URL
points-to: alias://app-pubseq_gateway

--- !scaling-group://web/cpu
deployed-by: deployment://app-pubseq_gateway
scale:
  min: 1
  max: 3

--- !profile://production-aws/permanent
region: aws-prod
execute: deployment://app-pubseq_gateway
aliases:
  - alias://app-pubseq_gateway
activated-test: echo Ok
test-env:
  - environment://app-pubseq_gateway
termination-delay: 1440 # 1 day

--- !port://proxy/public
attached-to: scaling-group://web

--- !artifact://uwsgi/facility
name: uwsgi
version: default

--- !environment://web-env-file/envfile
path: etc/.env

--- !deployment://app-pubseq_gateway/service
name: app-pubseq_gateway
uid: $CD_UID
project: cxx
contact-email: nobody@ncbi
unactivated-test: echo Ok
test-env:
  - environment://linkerd
  - environment://app-pubseq_gateway

--- !profile://production/permanent
region: bethesda-intproc
execute: deployment://app-pubseq_gateway
aliases:
  - alias://app-pubseq_gateway
activated-test: echo Ok
test-env:
  - environment://app-pubseq_gateway
termination-delay: 1440 # 1 day

--- !profile://development-aws/permanent
region: aws-dev
execute: deployment://app-pubseq_gateway
aliases:
  - alias://app-pubseq_gateway
activated-test: echo Ok
test-env:
  - environment://app-pubseq_gateway
termination-delay: 1440 # 1 day

--- !alias://app-pubseq_gateway/simple
name: app-pubseq_gateway
target: service://app-pubseq_gateway
consul-token: $CD_ALIAS_TOKEN

--- !location://pinger/pinger
proxy: runnable://front
from-path: /stat/

--- !runnable://cgi/procfile
set-env:
  - environment://backend
  - environment://psg
  - environment://linkerd
  - environment://web-env-file
  - environment://web-env-extra
member-of: scaling-group://web
path: Procfile
process-name: cgi
resources:
  cpu: 0.3
  mem: 512
install:
  - artifact://app-pubseq_gateway
  - artifact://uwsgi

--- !profile://sandbox/temporary
region: bethesda-dev
execute: deployment://app-pubseq_gateway
aliases:
  - alias://app-pubseq_gateway
termination-delay: 1440 # 1 day

--- !check://web-ping/http
for: service://app-pubseq_gateway
application-port: port://proxy
path: /health/
every: 10
timeout: 5

--- !runnable://front/proxy
set-env:
  - environment://backend
  - environment://psg
member-of: scaling-group://web
resources:
  cpu: 0.3
  mem: 256
install:
  - artifact://app-pubseq_gateway
listen-on: port://proxy

--- !location://static/dir
proxy: runnable://front
from-path: /static
to-path: /var/data/static
response-headers:
  X-Content-Type-Options: nosniff

--- !environment://web-env-extra/varlist
variables:
  no_proxy: 127.0.0.1,1.0.0.0/1,128.0.0.0/1
  APPLICATION_VERSION: unknown-37
  BACKEND_IP: 0.0.0.0


--- !service://app-pubseq_gateway/http
name: app-pubseq_gateway
exposed-by: scaling-group://web
exposed-on: port://proxy

--- !location://root/http
proxy: runnable://front
from-path: /
to-host: 127.0.0.1
to-port: port://backend
to-path: /

--- !environment://proxy/port
name: PUBLIC_PORT
points-to: port://proxy
